---
marp: true
theme: default
paginate: true
---

# Обучение нейросети с помощью SFT и RLHF

## Автор: Антон Шелин

---

## Введение

Экзаменационная работа по курсу "Построй свой ChatGPT".

---

## Цель

Обучить нейросеть Copilot для небольшой системы программирования BlackBox и языка Component Pascal.

---

## Проблема

Существующие модели путают этот язык с Delphi и Pascal и ничего не знают про систему BlackBox.

---

## Набор датасетов

1. Написан crawler для сбора данных с форума, посвященного этому ЯП и системе.
2. Экспортирован чат из Telegram.
3. Взята вся документация и код из системы, сконвертированы в txt формат.
4. На основе документации и кода с помощью модели Qwen-coder2.5 сгенерирован набор пар вопрос-ответ.

---

## Базовая модель

Так как система ориентирована на школьную сборку системы. Предполагается возможность запускать модель локально. Поэтому изначалально решено использовать небольшие модели 1.5B и 3B. В дальнейшем предполагается обучить модель 7B. За начальних тестов за основу вязата модель Cotype-Nano 1.5 B. Эта модель при малом размере показывает хорошие результаты на бенчмарках. Из недостатков можно отметить неустойчивое поведение модели при изменении настроек температуры и т.п. В дальнейшем предолагается обучить модель Qwen-coder2.5

---

## Обучение

### SFT обучение на текстах

Обучение на файлах документации и кода. 
Все файлы были токенезированы и разбиты на пересекающиеся куски одинаковой длины в 512 токенов с перекрытием в 32 токена. 
Изначально обучение зашло в тупик, train loss быстро падал, при этом validation loss или не изменялся или возрастал. 
Проблему переобучение удалось решить увеличением дропаута и снижением скорости обучения, ранним прерыванием.
После правок, модель стала давать осмысленные и часто корректные ответы.


---


## Обучение 2

### Обучение на сгенерированных вопросах ответах

Обучение на вопросах ответах было проведено с помощью чат темплейтов.
Но модель после первой же эпохи начинала переобучатся. Было решено не обучать более 2 эпох.
Ручное тестирование показало ухудьшение результатов генерации. После проверки сгенерированных пар вопросов ответов выяснилось, что вопросы сгенерированные из конкретных модулей делали некорректные обобщения. Например в модуле задается тип, а в вопросе предполагается что во всем ЯП этот тип и используется. Для исправление надо при генерации в будущем в промпте указывать контекст вопроса(конкретный модуль, ЯП, фреймоворк). 
Быстрое исправление было сделано через уменьшение скорости обучения, и генерации пар вопрос ответ только на документации ЯП и фреймворка. Это снизило время генерации и позволило генерировать вопросы по более крупным кускам текста.
---
## Заключение

Обучение нейросети с помощью SFT и RLHF позволяет создать модель, которая точно понимает и генерирует код на языке Component Pascal для системы BlackBox.

---

## Вопросы и ответы

Спасибо за внимание!

---